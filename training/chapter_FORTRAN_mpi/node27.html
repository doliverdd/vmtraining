<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2012 (1.2)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Queues, qsub, and the submit scripts</TITLE>
<META NAME="description" CONTENT="Queues, qsub, and the submit scripts">
<META NAME="keywords" CONTENT="chapter_FORTRAN_mpi">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2012">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="chapter_FORTRAN_mpi.css">

<LINK REL="next" HREF="node28.html">
<LINK REL="previous" HREF="node26.html">
<LINK REL="up" HREF="node26.html">
<LINK REL="next" HREF="node28.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A NAME="tex2html356"
  HREF="node28.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="file:/usr/share/latex2html/icons/next.png"></A> 
<A NAME="tex2html354"
  HREF="node26.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="file:/usr/share/latex2html/icons/up.png"></A> 
<A NAME="tex2html348"
  HREF="node26.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="file:/usr/share/latex2html/icons/prev.png"></A>   
<BR>
<B> Next:</B> <A NAME="tex2html357"
  HREF="node28.html">Exercises</A>
<B> Up:</B> <A NAME="tex2html355"
  HREF="node26.html">A Brief Introduction to</A>
<B> Previous:</B> <A NAME="tex2html349"
  HREF="node26.html">A Brief Introduction to</A>
<BR>
<BR>
<!--End of Navigation Panel-->

<H2><A NAME="SECTION00161000000000000000">
Queues, qsub, and the submit scripts</A>
</H2>
Queues are at the heart of PBS.  There are several types and a long list of
possible settings for each type.  This can be used to sort jobs by various
resources, and assign them different priorities.  On our cluster we run with
only one queue called router.

<P>
Jobs are submitted to the queuing system using the command <I>qsub</I>. In an
environment that has need of greater complexity, the command can be use to
control which queue a job enters, when the job is run, and controlling various
other aspects of a job.

<P>
While much of the job control can be accomplished using qsub command line
parameters, a preferable method is to use submission scripts.  These scripts
can set the environment and PBS variables to control the run. This is a
preferable method since it is much simpler to rerun a job with small changes.

<P>
Below is a sample script to run the HelloWorld program on 4 nodes.
<PRE>
#!/bin/sh
#PBS -l nodes=4
mpirun -np 4 -machinefile $PBS_NODEFILE HelloWorld
       -pgf77
</PRE>
If these lines were in a file called hello.pbs, then the program HelloWorld
could be submitted to the cluster with the command "qsub hello.pbs".
Although this is a simple file, there are a few points of interest.  The line
"#PBS -l nodes =4" is a PBS directive line.  Any line that starts with #PBS
is interpreted as a directive.  In this case it is telling PBS that it
needs 4 nodes to execute the program.  Notice that this number matches the
parameter -np in the mpirun line.  The number allocated by PBS must be greater
than or equal to the number requested by the mpirun command.  In the
mpirun line we have a PBS environment variable.  Although this is a shell
script PBS makes certain changes to the environment.  In this case, a list of
nodes that PBS is making available is stored in the $PBS_NODEFILE variable
and passed to mpirun.

<P>
If the above program were submitted with the qsub program above we would see
the following sequence of events.
<PRE>
&gt;qsub hello.pbs
&gt;100.mimir
</PRE>
This would be telling you that your job was assigned the number 100. When
the job was finished you would have two new files in this directory with
the names "hello.pbs.e100" and "hello.pbs.o100". The .e file contains the
output from standard error, and any errors that PBS encounters.  The .o file
contains the output from the submit script and the program.

<P>
The list below show some of the common modifications to the submit script
that you might want to use.

<P>
<DL>
<DT><STRONG>#PBS -joe</STRONG></DT>
<DD>Combine the error and output files.
</DD>
<DT><STRONG>#PBS -N </STRONG></DT>
<DD>Set the name of the job. This affects the name of the output
files.
</DD>
<DT><STRONG>#PBS -l</STRONG></DT>
<DD>Sets the resource lists for the jobs -l can be followed by
a resource list which often includes the following items.
   
<UL>
<LI>nodes - Specifies which may be followed by a formatted string specifying which nodes to use.
</LI>
<LI>ncpus - Sets how many cpus are needed. This is more important with
SMP nodes, or in a pure SMP environment.
</LI>
<LI>walltime - Sets an upper limit on the length of the job.
</LI>
<LI>cputime - Sets an upper limit on the cpu time used for the job.
   
</LI>
</UL>
</DD>
<DT><STRONG>cd</STRONG></DT>
<DD>Change the directory.
</DD>
</DL>

<P>
There are many other options available and the complete Users Guide is available
on line from ftp.acomp.usf.edu.
<HR>
<!--Navigation Panel-->
<A NAME="tex2html356"
  HREF="node28.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="file:/usr/share/latex2html/icons/next.png"></A> 
<A NAME="tex2html354"
  HREF="node26.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="file:/usr/share/latex2html/icons/up.png"></A> 
<A NAME="tex2html348"
  HREF="node26.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="file:/usr/share/latex2html/icons/prev.png"></A>   
<BR>
<B> Next:</B> <A NAME="tex2html357"
  HREF="node28.html">Exercises</A>
<B> Up:</B> <A NAME="tex2html355"
  HREF="node26.html">A Brief Introduction to</A>
<B> Previous:</B> <A NAME="tex2html349"
  HREF="node26.html">A Brief Introduction to</A>
<!--End of Navigation Panel-->
<ADDRESS>
root
2015-12-02
</ADDRESS>
</BODY>
</HTML>
