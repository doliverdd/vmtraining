<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2012 (1.2)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Make</TITLE>
<META NAME="description" CONTENT="Make">
<META NAME="keywords" CONTENT="chapter5_d">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2012">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="chapter5_d.css">

<LINK REL="next" HREF="node4.html">
<LINK REL="previous" HREF="node2.html">
<LINK REL="up" HREF="node1.html">
<LINK REL="next" HREF="node4.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A NAME="tex2html46"
  HREF="node4.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="file:/usr/share/latex2html/icons/next.png"></A> 
<A NAME="tex2html44"
  HREF="node1.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="file:/usr/share/latex2html/icons/up.png"></A> 
<A NAME="tex2html38"
  HREF="node2.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="file:/usr/share/latex2html/icons/prev.png"></A>   
<BR>
<B> Next:</B> <A NAME="tex2html47"
  HREF="node4.html">Exercises</A>
<B> Up:</B> <A NAME="tex2html45"
  HREF="node1.html">Compiling Basics and Make</A>
<B> Previous:</B> <A NAME="tex2html39"
  HREF="node2.html">Compiling Basics</A>
<BR>
<BR>
<!--End of Navigation Panel-->

<H1><A NAME="SECTION00120000000000000000">
Make</A>
</H1>
As you can see by now the compiling and linking of large research codes can
begin to be quite complicated.  Imagine that instead of three files in the
last section we had been dealing with one hundred source and header files. 
Added to this problem is that if you change one of the source files it is 
ineffecient to have to recompile all of them.  But how can you keep track of 
the dependencies and how can you know when a file was last compiled?  The 
answer on *nix systems is <I>make</I> <A NAME="43"></A>.  
Make is a program that is designed to do exactly this, keep track of 
dependencies, and determine when program files need to be recompiled.  The
syntax of a make file is not always clear, but with a little experience it
can be very helpful.  

<P>
Make must know what you want to compile (<I>targets</I>), what other files
the program needs (<I>dependencies</I>), and how you want to compile the
program (<I>commands</I>). <A NAME="47"></A> <A NAME="48"></A> <A NAME="49"></A>
Lets suppose that we have the following rather typical scenerio. We want to
make a program myProgram.  The main file is called myProgram.c and it
is dependent on two other source files sub1.c and sub2.c.  The programs
use the math library (-lm) and a library abc which is contained in the /opt/lib
directory.  The include files for abc are in the /opt/include directory.  
Additionally each of the c files has an associated header file, and they
may call functions from each other.  The make file for this may look like:

<P>
<PRE>
# Makefile for myProgram
myProgram: sub1.o sub2.o myProgram.o 
   gcc -o myProgram -L/opt/lib -I/opt/include  \ 
	  -labc sub1.o sub2.o myProgram.o

myProgram.o: myProgram.c sub1.h sub2.h
   gcc -c -o myProgram.o -L/opt/lib -I/opt/include \
	  -labc myProgram.c

sub1.o: sub1.c sub1.h
   gcc -c -o sub1.o -L/opt/lib -I/opt/include -labc sub1.c

sub2.o: sub2.c sub2.h
   gcc -c -o sub2.o -L/opt/lib -I/opt/include -labc sub2.c
</PRE>

<P>
Let's look at this file in some detail. The first line is a comment.
The lines that begin with a program 
name and a colon followed by a list of files is a target-dependency line.
What goes before the colon is the <I>target</I> and the other files are the
<I>dependencies</I>.  Make will keep track of which of these files have
changed since the target was last compiled, and will recompile them before 
compiling the target. It will not recompile a target if none of the dependencies
have changed.  Notice the <code>\</code> at the end of the first gcc line.  This is
the continuation character for make so these two lines are treated as one. 
Extra white space is deleted when a continuation character is used.  This 
leads to one of the most frustrating aspects of the makefile for new users.
The gcc lines must begin with a tab or make has a problem.  By default, make
compiles the first target.  If you want to compile one of the other targets
you can (for example) just type make sub1.o and only that target and it's 
dependencies (if necessary) will be compiled.

<P>
Make allows assigning values to variables.  This can clean up the lines of 
a make file.  We've done this in the second version of the make file for
myProgram.
<PRE>
# Makefile for myProgram
LIBS = -L /opt/lib -labc
INCLUDES = -I /opt/include
OBJECTS = sub1.o sub2.o myProgram.o
myProgram: $(OBJECTS) 
   gcc -o myProgram $(INCLUDES) $(LIBS) $(OBJECTS)  
	  

myProgram.o: myProgram.c sub1.h sub2.h
   gcc -c -o myProgram.o $(LIBS) $(INCLUDES) myProgram.c

sub1.o: sub1.c sub1.h
   gcc -c -o sub1.o $(INCLUDES) $(LIBS) sub1.c

sub2.o: sub2.c sub2.h
   gcc -c -o sub2.o $(INCLUDES) $(LIBS) sub2.c

clean:
   /bin/rm *.o
</PRE>

<P>
In this version we assign the library directories, include directories, and
object files to variables, which are then used in the dependencies and 
command lines.  This not only makes the file more readable, it also helps 
when adding or removing files from the project. We've also added a dummy target
clean.  This is a common practice.  In this case we've removed all of the 
.o files.  This feature makes it easier to move projects between systems and
to handle changes in the library files.  In effect what it does is remove all
of the .o files so that the next run will recompile everything. This dummy
target adds significant flexibility to make.

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html46"
  HREF="node4.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="file:/usr/share/latex2html/icons/next.png"></A> 
<A NAME="tex2html44"
  HREF="node1.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="file:/usr/share/latex2html/icons/up.png"></A> 
<A NAME="tex2html38"
  HREF="node2.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="file:/usr/share/latex2html/icons/prev.png"></A>   
<BR>
<B> Next:</B> <A NAME="tex2html47"
  HREF="node4.html">Exercises</A>
<B> Up:</B> <A NAME="tex2html45"
  HREF="node1.html">Compiling Basics and Make</A>
<B> Previous:</B> <A NAME="tex2html39"
  HREF="node2.html">Compiling Basics</A>
<!--End of Navigation Panel-->
<ADDRESS>
root
2015-12-02
</ADDRESS>
</BODY>
</HTML>
