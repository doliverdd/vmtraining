<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2012 (1.2)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Transferring Data from Arrays</TITLE>
<META NAME="description" CONTENT="Transferring Data from Arrays">
<META NAME="keywords" CONTENT="chapter_C_mpi">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2012">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="chapter_C_mpi.css">

<LINK REL="next" HREF="node9.html">
<LINK REL="previous" HREF="node6.html">
<LINK REL="up" HREF="node6.html">
<LINK REL="next" HREF="node8.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A NAME="tex2html131"
  HREF="node8.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="file:/usr/share/latex2html/icons/next.png"></A> 
<A NAME="tex2html129"
  HREF="node6.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="file:/usr/share/latex2html/icons/up.png"></A> 
<A NAME="tex2html123"
  HREF="node6.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="file:/usr/share/latex2html/icons/prev.png"></A>   
<BR>
<B> Next:</B> <A NAME="tex2html132"
  HREF="node8.html">Derived Data Types</A>
<B> Up:</B> <A NAME="tex2html130"
  HREF="node6.html">Point to Point Communications</A>
<B> Previous:</B> <A NAME="tex2html124"
  HREF="node6.html">Point to Point Communications</A>
<BR>
<BR>
<!--End of Navigation Panel-->

<H2><A NAME="SECTION00121000000000000000">
Transferring Data from Arrays</A>
</H2>
We specify the location of the first element to be sent or
received when we call MPI communication subroutines. For a
successful communication, the rest of the elements to be transferred
must be contiguous in the memory. Since C stores the
elements of a two-dimensional array in row major order, sending
a row of an array is straightforward.  Let us examine the
following program that computes the elapsed time for the data
exchange between two processes.

<P>
<PRE>
/* Demonstration of communicating an array */
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;mpi.h&gt;
#define ARRAY_SIZE 25
main(int argc,char* argv[]){
	
   int				my_rank;
   int				p;
   int				source;
   int				dest;
   int				tag=0;
   int			    i,j;
   double		    a[ARRAY_SIZE][ARRAY_SIZE]; 
   double		    b[ARRAY_SIZE][ARRAY_SIZE]; 
   double		    t1,t2,resol;
   char			    message[100];
   MPI_Status		status;

   /*Start MPI*/
   MPI_Init(&amp;argc,&amp;argv);
   /*Find out process rank*/
   MPI_Comm_rank(MPI_COMM_WORLD,&amp;my_rank);
   /*Find out the number of processes*/
   MPI_Comm_size(MPI_COMM_WORLD,&amp;p);

   resol=MPI_Wtick();
   printf("clock resolution %f\n",resol);

   if (my_rank==0){ 
      for(i=0;i&lt;ARRAY_SIZE;i++)
        for(j=0;j&lt;ARRAY_SIZE;j++){
           a[i][j]=1.0;
           b[i][j]=0.0;
        }
   }        
   if (my_rank==1){
      for(i=0;i&lt;ARRAY_SIZE;i++)
        for(j=0;j&lt;ARRAY_SIZE;j++){
           a[i][j]=0.0;
           b[i][j]=2.0;
        }
   }
   MPI_Barrier(MPI_COMM_WORLD);

   if (my_rank==0){
        t1=MPI_Wtime();

      MPI_Send(a,ARRAY_SIZE*2,
         MPI_DOUBLE,1,tag,MPI_COMM_WORLD);
      MPI_Recv(b,ARRAY_SIZE*2,
         MPI_DOUBLE,1,tag,MPI_COMM_WORLD,&amp;status);

      t2=MPI_Wtime();
	  printf("communication time %10.5f process %d\n",
			  t2-t1,my_rank);
   }
   if (my_rank==1){
      t1=MPI_Wtime();
      MPI_Send(b,ARRAY_SIZE*2,
         MPI_DOUBLE,0,tag,MPI_COMM_WORLD);
      MPI_Recv(a,ARRAY_SIZE*2,
         MPI_DOUBLE,0,tag,MPI_COMM_WORLD,&amp;status);
      t2=MPI_Wtime();
	  printf("communication time %10.5f process %d\n",
			  t2-t1,my_rank);
   }
   MPI_Finalize();
}
</PRE>
First, let us explain briefly some of the subroutines we have used
for the first time. MPI_Wtick is used to determine the clock
resolution and MPI_Wtime gives the elapsed time.

<P>
The MPI_Barrier subroutine blocks each process until each one has
called it. It is used for synchronization. In other words,  it
ensures that the processes start sending and receiving at the same
time. MPI_Barrier can be used for blocking multiple processes; it
is a collective communication subroutine.  We will see more about
collective communications in the next section.

<P>
In this program, each process transfers the first and second
rows of the array initialized on them. If we increased the
number of rows to be transferred more and more, MPI_Send and
MPI_Recv would eventually fail. In this case, non-blocking
calls would still be working.
<BR><HR>
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL>
<LI><A NAME="tex2html133"
  HREF="node8.html">Derived Data Types</A>
</UL>
<!--End of Table of Child-Links-->
<HR>
<!--Navigation Panel-->
<A NAME="tex2html131"
  HREF="node8.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="file:/usr/share/latex2html/icons/next.png"></A> 
<A NAME="tex2html129"
  HREF="node6.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="file:/usr/share/latex2html/icons/up.png"></A> 
<A NAME="tex2html123"
  HREF="node6.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="file:/usr/share/latex2html/icons/prev.png"></A>   
<BR>
<B> Next:</B> <A NAME="tex2html132"
  HREF="node8.html">Derived Data Types</A>
<B> Up:</B> <A NAME="tex2html130"
  HREF="node6.html">Point to Point Communications</A>
<B> Previous:</B> <A NAME="tex2html124"
  HREF="node6.html">Point to Point Communications</A>
<!--End of Navigation Panel-->
<ADDRESS>
root
2015-12-02
</ADDRESS>
</BODY>
</HTML>
